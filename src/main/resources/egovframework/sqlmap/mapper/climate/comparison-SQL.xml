<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="comparison">

	<sql id="comparisonSgg">
	<![CDATA[
		WITH E01 AS (
		SELECT DISTRICT_CD FROM DISTRICT_SGG 
		)
		,E011 AS(
		SELECT B.DISTRICT_CD, C.DISTRICT_NM AS SD_NM, B.DISTRICT_NM AS SGG_NM FROM DISTRICT_SGG B
		JOIN DISTRICT_SD C ON SUBSTR(B.DISTRICT_CD,1,2) = C.DISTRICT_CD 
		ORDER BY DISTRICT_CD ASC
		)
		,E02 AS (
		SELECT INDI_ID,INDI_SPACE FROM INDICATOR_LIST WHERE INDI_ID IN(SELECT INDI_ID FROM ITEM_INDICATOR WHERE ITEM_ID=
		#{item}
		))
		,E021 AS (
		SELECT A.INDI_ID, B.DISTRICT_CD, A.INDI_SPACE FROM E02 A CROSS JOIN E01 B
		)
		,E022 AS (
		SELECT INDI_ID, DISTRICT_CD, CASE 
		WHEN INDI_SPACE='SPA01' THEN (SELECT INDI_VAL FROM INDICATOR_DATA X WHERE 1=1 AND X.INDI_ID = Z.INDI_ID AND X.DISTRICT_CD = Z.DISTRICT_CD AND Z.INDI_YEAR = X.INDI_YEAR) 
		WHEN INDI_SPACE='SPA02' THEN (SELECT INDI_VAL FROM INDICATOR_DATA X WHERE 1=1 AND X.INDI_ID = Z.INDI_ID AND X.DISTRICT_CD = SUBSTR(Z.DISTRICT_CD,1,5) AND Z.INDI_YEAR = X.INDI_YEAR) 
		WHEN INDI_SPACE='SPA03' THEN (SELECT INDI_VAL FROM INDICATOR_DATA X WHERE 1=1 AND X.INDI_ID = Z.INDI_ID AND X.DISTRICT_CD = SUBSTR(Z.DISTRICT_CD,1,2) AND Z.INDI_YEAR = X.INDI_YEAR) 
		END INDI_VAL 
		FROM(
		SELECT INDI_ID, DISTRICT_CD, CASE 
		WHEN INDI_SPACE='SPA01' THEN (SELECT MAX(INDI_YEAR) FROM INDICATOR_DATA X WHERE X.INDI_ID = Y.INDI_ID AND X.DISTRICT_CD = Y.DISTRICT_CD) 
		WHEN INDI_SPACE='SPA02' THEN (SELECT MAX(INDI_YEAR) FROM INDICATOR_DATA X WHERE X.INDI_ID = Y.INDI_ID AND X.DISTRICT_CD = SUBSTR(Y.DISTRICT_CD,1,5)) 
		WHEN INDI_SPACE='SPA03' THEN (SELECT MAX(INDI_YEAR) FROM INDICATOR_DATA X WHERE X.INDI_ID = Y.INDI_ID AND X.DISTRICT_CD = SUBSTR(Y.DISTRICT_CD,1,2)) 
		END INDI_YEAR
		,INDI_SPACE
		FROM E021 Y
		)Z
		)
		,E03 AS (
		SELECT SCEN_ID,SCEN_CONSTRUCT FROM SCENARIO_LIST WHERE SCEN_ID IN(SELECT INDI_ID FROM ITEM_INDICATOR WHERE ITEM_ID=
		#{item}
		))
		,E031 AS (
		SELECT A.SCEN_ID, B.DISTRICT_CD, A.SCEN_CONSTRUCT FROM E03 A CROSS JOIN E01 B
		)
		,E032 AS (
		SELECT SCEN_ID, DISTRICT_CD, (SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND X.DISTRICT_CD <> Y.DISTRICT_CD AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M1_EMD_CNT
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M1_SGG_CNT
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND X.DISTRICT_CD <> Y.DISTRICT_CD AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M2_EMD_CNT
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M2_SGG_CNT
		FROM E031 Y 
		)
		,E033 AS (
		SELECT SCEN_ID, DISTRICT_CD, CASE 
		WHEN M1_EMD_CNT > 0 THEN #{model}
		WHEN M1_SGG_CNT > 0 THEN #{model}
		WHEN M2_EMD_CNT > 0 THEN #{adjModel}
		WHEN M2_SGG_CNT > 0 THEN #{adjModel}
		END AS MDL_ID,
		CASE 
		WHEN M1_EMD_CNT > 0 THEN (SELECT AVG(SCEN_VAL) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND X.DISTRICT_CD <> Y.DISTRICT_CD AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year})
		WHEN M1_SGG_CNT > 0 THEN (SELECT SCEN_VAL FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD = Y.DISTRICT_CD AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year})
		WHEN M2_EMD_CNT > 0 THEN (SELECT AVG(SCEN_VAL) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND X.DISTRICT_CD <> Y.DISTRICT_CD AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year})
		WHEN M2_SGG_CNT > 0 THEN (SELECT SCEN_VAL FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD = Y.DISTRICT_CD AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year})
		END AS SCEN_VAL
		FROM E032 Y
		)
		,E04 AS (
		SELECT INDI_ID, DISTRICT_CD, INDI_VAL FROM E022 UNION ALL SELECT SCEN_ID, DISTRICT_CD, SCEN_VAL FROM E033
		)
		,E05 AS (
		SELECT A.INDI_ID ,MAX(A.INDI_VAL) AS MAX_VALUE ,MIN(A.INDI_VAL) AS MIN_VALUE FROM E04 A GROUP BY INDI_ID 
		)
		,E06 AS (
		SELECT BASE.INDI_ID ,BASE.DISTRICT_CD ,BASE.INDI_VAL ,GNRL.MAX_VALUE ,GNRL.MIN_VALUE FROM E04 BASE LEFT JOIN E05 GNRL ON BASE.INDI_ID = GNRL.INDI_ID ORDER BY BASE.INDI_ID ASC, BASE.DISTRICT_CD 
		)
		,E07 AS (
		SELECT RSLT.INDI_ID ,RSLT.DISTRICT_CD ,CASE WHEN RSLT.MAX_VALUE-RSLT.MIN_VALUE = 0 THEN 0 ELSE ((RSLT.INDI_VAL-RSLT.MIN_VALUE)/(RSLT.MAX_VALUE-RSLT.MIN_VALUE)) END AS GNRL_VALUE FROM E06 RSLT
		)
		,E08 AS (
		SELECT ESTI.ITEM_ID ,ESTI.SECTOR_ID ,ESTI.INDI_ID ,INDI.DISTRICT_CD , ESTI.INDI_VAL_WEIGHT, INDI.GNRL_VALUE , (ESTI.INDI_VAL_WEIGHT * INDI.GNRL_VALUE) AS WEIGHT_GNRL_VALUE FROM ITEM_INDICATOR ESTI JOIN E07 INDI ON ESTI.INDI_ID = INDI.INDI_ID 
		WHERE ESTI.ITEM_ID = 
		#{item}
		)
		,E09 AS (
		SELECT GRSM.ITEM_ID ,GRSM.SECTOR_ID , GRSM.DISTRICT_CD , SUM(GRSM.WEIGHT_GNRL_VALUE)AS WEI_SUM_VALUE FROM E08 GRSM GROUP BY GRSM.ITEM_ID,GRSM.SECTOR_ID,GRSM.DISTRICT_CD 
		)
		,E10 AS ( 
		SELECT ESRS.ITEM_ID, ESRS.DISTRICT_CD , CASE ESRS.SECTOR_ID WHEN 'SEC01' THEN ESRS.WEI_SUM_VALUE ELSE 0.00 END AS CLIM , CASE ESRS.SECTOR_ID WHEN 'SEC02' THEN ESRS.WEI_SUM_VALUE ELSE 0.00 END AS SENS ,CASE ESRS.SECTOR_ID WHEN 'SEC03' THEN ESRS.WEI_SUM_VALUE ELSE 0.00 END AS ADAP FROM E09 ESRS
		)
		,E11 AS (SELECT ESTB.ITEM_ID ,ESTB.DISTRICT_CD , SUM(ESTB.CLIM) AS CLIM_VALUE ,SUM(ESTB.SENS) AS SENS_VALUE , SUM(ESTB.ADAP) AS ADAP_VALUE FROM E10 ESTB GROUP BY ESTB.ITEM_ID, ESTB.DISTRICT_CD
		)
		,E12 AS (
		SELECT ESWE.ITEM_ID ,ESMS.ITEM_NM , ESWE.DISTRICT_CD ,TRUNC(ESWE.CLIM_VALUE*ESMS.CE_WEIGHT::NUMERIC,2) AS CLIM_VALUE 
		,TRUNC(ESWE.SENS_VALUE*ESMS.CS_WEIGHT::NUMERIC,2) AS SENS_VALUE , TRUNC(ESWE.ADAP_VALUE*ESMS.AA_WEIGHT::NUMERIC,2) AS ADAP_VALUE 
		,TRUNC((TRUNC(ESWE.CLIM_VALUE*ESMS.CE_WEIGHT::NUMERIC,2)+TRUNC(ESWE.SENS_VALUE*ESMS.CS_WEIGHT::NUMERIC,2)-TRUNC(ESWE.ADAP_VALUE*ESMS.AA_WEIGHT::NUMERIC,2))::NUMERIC,2) AS ESTI_VALUE
		FROM ITEM_LIST ESMS RIGHT JOIN E11 ESWE ON ESWE.ITEM_ID = ESMS.ITEM_ID 
		)
		,E13 AS(
		SELECT ROW_NUMBER () OVER (ORDER BY ESTI_VALUE DESC, CLIM_VALUE ASC, SENS_VALUE ASC, ADAP_VALUE ASC)::TEXT AS NO, ESTM.ITEM_NM , ESTM.DISTRICT_CD, SGG.SD_NM, SGG.SGG_NM, ESTM.CLIM_VALUE, ESTM.SENS_VALUE, ESTM.ADAP_VALUE, ESTM.ESTI_VALUE FROM E12 ESTM
		JOIN E011 SGG ON ESTM.DISTRICT_CD = SGG.DISTRICT_CD 
		ORDER BY ESTI_VALUE DESC, CLIM_VALUE ASC, SENS_VALUE ASC, ADAP_VALUE ASC
		)
		]]>
	</sql>
	
	<sql id="comparisonSd">
	<![CDATA[
		WITH E01 AS (
		SELECT DISTRICT_CD FROM DISTRICT_SD
		)
		,E011 AS(
		SELECT DISTRICT_CD, DISTRICT_NM AS SD_NM FROM DISTRICT_SD
		ORDER BY DISTRICT_CD ASC
		)
		,E02 AS (
		SELECT INDI_ID,INDI_SPACE FROM INDICATOR_LIST WHERE INDI_ID IN(SELECT INDI_ID FROM ITEM_INDICATOR WHERE ITEM_ID=
		#{item}
		))
		,E021 AS (
		SELECT A.INDI_ID, B.DISTRICT_CD, A.INDI_SPACE FROM E02 A CROSS JOIN E01 B
		)
		,E022 AS (
		SELECT INDI_ID, DISTRICT_CD, CASE 
		WHEN INDI_SPACE='SPA01' THEN (SELECT INDI_VAL FROM INDICATOR_DATA X WHERE 1=1 AND X.INDI_ID = Z.INDI_ID AND X.DISTRICT_CD = Z.DISTRICT_CD AND Z.INDI_YEAR = X.INDI_YEAR) 
		WHEN INDI_SPACE='SPA02' THEN (SELECT INDI_VAL FROM INDICATOR_DATA X WHERE 1=1 AND X.INDI_ID = Z.INDI_ID AND X.DISTRICT_CD = SUBSTR(Z.DISTRICT_CD,1,5) AND Z.INDI_YEAR = X.INDI_YEAR) 
		WHEN INDI_SPACE='SPA03' THEN (SELECT INDI_VAL FROM INDICATOR_DATA X WHERE 1=1 AND X.INDI_ID = Z.INDI_ID AND X.DISTRICT_CD = SUBSTR(Z.DISTRICT_CD,1,2) AND Z.INDI_YEAR = X.INDI_YEAR) 
		END INDI_VAL 
		FROM(
		SELECT INDI_ID, DISTRICT_CD, CASE 
		WHEN INDI_SPACE='SPA01' THEN (SELECT MAX(INDI_YEAR) FROM INDICATOR_DATA X WHERE X.INDI_ID = Y.INDI_ID AND X.DISTRICT_CD = Y.DISTRICT_CD) 
		WHEN INDI_SPACE='SPA02' THEN (SELECT MAX(INDI_YEAR) FROM INDICATOR_DATA X WHERE X.INDI_ID = Y.INDI_ID AND X.DISTRICT_CD = SUBSTR(Y.DISTRICT_CD,1,5)) 
		WHEN INDI_SPACE='SPA03' THEN (SELECT MAX(INDI_YEAR) FROM INDICATOR_DATA X WHERE X.INDI_ID = Y.INDI_ID AND X.DISTRICT_CD = SUBSTR(Y.DISTRICT_CD,1,2)) 
		END INDI_YEAR
		,INDI_SPACE
		FROM E021 Y
		)Z
		)
		,E03 AS (
		SELECT SCEN_ID,SCEN_CONSTRUCT FROM SCENARIO_LIST WHERE SCEN_ID IN(SELECT INDI_ID FROM ITEM_INDICATOR WHERE ITEM_ID=
		#{item}
		))
		,E031 AS (
		SELECT A.SCEN_ID, B.DISTRICT_CD, A.SCEN_CONSTRUCT FROM E03 A CROSS JOIN E01 B
		)
		,E032 AS (
		SELECT SCEN_ID, DISTRICT_CD
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 7 AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M1_EMD_CNT
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 5 AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M1_SGG_CNT
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 7 AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M2_EMD_CNT
		,(SELECT COUNT(*) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 5 AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) AS M2_SGG_CNT
		FROM E031 Y 
		)
		,E033 AS (
		SELECT SCEN_ID, DISTRICT_CD, CASE 
		WHEN M1_EMD_CNT > 0 THEN #{model}
		WHEN M1_SGG_CNT > 0 THEN #{model}
		WHEN M2_EMD_CNT > 0 THEN #{adjModel}
		WHEN M2_SGG_CNT > 0 THEN #{adjModel}
		END AS MDL_ID,
		CASE 
		WHEN M1_EMD_CNT > 0 THEN (SELECT AVG(SCEN_VAL) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 7 AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) 
		WHEN M1_SGG_CNT > 0 THEN (SELECT AVG(SCEN_VAL) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 5 AND MDL_ID = #{model} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) 
		WHEN M2_EMD_CNT > 0 THEN (SELECT AVG(SCEN_VAL) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 7 AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) 
		WHEN M2_SGG_CNT > 0 THEN (SELECT AVG(SCEN_VAL) FROM SCENARIO_DATA X WHERE X.SCEN_ID = Y.SCEN_ID AND X.DISTRICT_CD LIKE Y.DISTRICT_CD ||'%' AND LENGTH(X.DISTRICT_CD) = 5 AND MDL_ID = #{adjModel} AND SCEN_SECTION = #{section} AND SCEN_YEAR = #{year}) 
		END AS SCEN_VAL
		FROM E032 Y
		)
		,E04 AS (
		SELECT INDI_ID, DISTRICT_CD, INDI_VAL FROM E022 UNION ALL SELECT SCEN_ID, DISTRICT_CD, SCEN_VAL FROM E033
		)
		,E05 AS (
		SELECT A.INDI_ID ,MAX(A.INDI_VAL) AS MAX_VALUE ,MIN(A.INDI_VAL) AS MIN_VALUE FROM E04 A GROUP BY INDI_ID 
		)
		,E06 AS (
		SELECT BASE.INDI_ID ,BASE.DISTRICT_CD ,BASE.INDI_VAL ,GNRL.MAX_VALUE ,GNRL.MIN_VALUE FROM E04 BASE LEFT JOIN E05 GNRL ON BASE.INDI_ID = GNRL.INDI_ID ORDER BY BASE.INDI_ID ASC, BASE.DISTRICT_CD 
		)
		,E07 AS (
		SELECT RSLT.INDI_ID ,RSLT.DISTRICT_CD ,CASE WHEN RSLT.MAX_VALUE-RSLT.MIN_VALUE = 0 THEN 0 ELSE ((RSLT.INDI_VAL-RSLT.MIN_VALUE)/(RSLT.MAX_VALUE-RSLT.MIN_VALUE)) END AS GNRL_VALUE FROM E06 RSLT
		)
		,E08 AS (
		SELECT ESTI.ITEM_ID ,ESTI.SECTOR_ID ,ESTI.INDI_ID ,INDI.DISTRICT_CD , ESTI.INDI_VAL_WEIGHT, INDI.GNRL_VALUE , (ESTI.INDI_VAL_WEIGHT * INDI.GNRL_VALUE) AS WEIGHT_GNRL_VALUE FROM ITEM_INDICATOR ESTI JOIN E07 INDI ON ESTI.INDI_ID = INDI.INDI_ID 
		WHERE ESTI.ITEM_ID = 
		#{item}
		)
		,E09 AS (
		SELECT GRSM.ITEM_ID ,GRSM.SECTOR_ID , GRSM.DISTRICT_CD , SUM(GRSM.WEIGHT_GNRL_VALUE)AS WEI_SUM_VALUE FROM E08 GRSM GROUP BY GRSM.ITEM_ID,GRSM.SECTOR_ID,GRSM.DISTRICT_CD 
		)
		,E10 AS ( 
		SELECT ESRS.ITEM_ID, ESRS.DISTRICT_CD , CASE ESRS.SECTOR_ID WHEN 'SEC01' THEN ESRS.WEI_SUM_VALUE ELSE 0.00 END AS CLIM , CASE ESRS.SECTOR_ID WHEN 'SEC02' THEN ESRS.WEI_SUM_VALUE ELSE 0.00 END AS SENS ,CASE ESRS.SECTOR_ID WHEN 'SEC03' THEN ESRS.WEI_SUM_VALUE ELSE 0.00 END AS ADAP FROM E09 ESRS
		)
		,E11 AS (SELECT ESTB.ITEM_ID ,ESTB.DISTRICT_CD , SUM(ESTB.CLIM) AS CLIM_VALUE ,SUM(ESTB.SENS) AS SENS_VALUE , SUM(ESTB.ADAP) AS ADAP_VALUE FROM E10 ESTB GROUP BY ESTB.ITEM_ID, ESTB.DISTRICT_CD
		)
		,E12 AS (
		SELECT ESWE.ITEM_ID ,ESMS.ITEM_NM , ESWE.DISTRICT_CD ,TRUNC(ESWE.CLIM_VALUE*ESMS.CE_WEIGHT::NUMERIC,2) AS CLIM_VALUE 
		,TRUNC(ESWE.SENS_VALUE*ESMS.CS_WEIGHT::NUMERIC,2) AS SENS_VALUE , TRUNC(ESWE.ADAP_VALUE*ESMS.AA_WEIGHT::NUMERIC,2) AS ADAP_VALUE 
		,TRUNC((TRUNC(ESWE.CLIM_VALUE*ESMS.CE_WEIGHT::NUMERIC,2)+TRUNC(ESWE.SENS_VALUE*ESMS.CS_WEIGHT::NUMERIC,2)-TRUNC(ESWE.ADAP_VALUE*ESMS.AA_WEIGHT::NUMERIC,2))::NUMERIC,2) AS ESTI_VALUE
		FROM ITEM_LIST ESMS RIGHT JOIN E11 ESWE ON ESWE.ITEM_ID = ESMS.ITEM_ID 
		)
		,E13 AS(
		SELECT ROW_NUMBER () OVER (ORDER BY ESTI_VALUE DESC, CLIM_VALUE ASC, SENS_VALUE ASC, ADAP_VALUE ASC)::TEXT AS NO, ESTM.ITEM_NM , ESTM.DISTRICT_CD, SD.SD_NM, ESTM.CLIM_VALUE, ESTM.SENS_VALUE, ESTM.ADAP_VALUE, ESTM.ESTI_VALUE FROM E12 ESTM
		JOIN E011 SD ON ESTM.DISTRICT_CD = SD.DISTRICT_CD 
		ORDER BY ESTI_VALUE DESC, CLIM_VALUE ASC, SENS_VALUE ASC, ADAP_VALUE ASC
		)
			]]>
	</sql>

	<select id="selectComparisonSgg" parameterType="EgovMap" resultType="EgovMap">
		<include refid="comparisonSgg" />
		<![CDATA[
			SELECT
				NO
				, ITEM_NM
				, DISTRICT_CD
				, SD_NM
				, SGG_NM
				, CLIM_VALUE
				, SENS_VALUE
				, ADAP_VALUE
				, ESTI_VALUE	
				, NULL AS MIN_VALUE
				, NULL AS MAX_VALUE
			FROM E13 WHERE DISTRICT_CD IN (#{sigungu},#{sigunguC})
			UNION ALL
			SELECT 
				'' AS NO
				, ITEM_NM
				, '' AS DISTRICT_CD
				, '전국' AS SD_NM
				, '평균' AS SGG_NM
				, TRUNC(AVG(CLIM_VALUE),2) AS CLIM_VALUE
				, TRUNC(AVG(SENS_VALUE),2) AS SENS_VALUE
				, TRUNC(AVG(ADAP_VALUE),2) AS ADAP_VALUE
				, TRUNC(AVG(ESTI_VALUE),2) AS ESTI_VALUE
				, TRUNC(MIN(ESTI_VALUE),2) AS MIN_VALUE
				, TRUNC(MAX(ESTI_VALUE),2) AS MAX_VALUE
			 FROM 
			 E13
			 GROUP BY ITEM_NM
		]]>
	</select>
	
	<select id="selectComparisonSd"	parameterType="EgovMap" resultType="EgovMap">
		<include refid="comparisonSd" />
		<![CDATA[
			SELECT 
				NO
				, ITEM_NM
				, DISTRICT_CD
				, SD_NM
				, CLIM_VALUE
				, SENS_VALUE
				, ADAP_VALUE
				, ESTI_VALUE	
				, NULL AS MIN_VALUE
				, NULL AS MAX_VALUE
			FROM E13 WHERE DISTRICT_CD IN (#{sido},#{sidoC})
			UNION ALL
			SELECT 
				'' AS NO
				, ITEM_NM
				, '' AS DISTRICT_CD
				, '전국 평균' AS SD_NM
				, TRUNC(AVG(CLIM_VALUE),2) AS CLIM_VALUE
				, TRUNC(AVG(SENS_VALUE),2) AS SENS_VALUE
				, TRUNC(AVG(ADAP_VALUE),2) AS ADAP_VALUE
				, TRUNC(AVG(ESTI_VALUE),2) AS ESTI_VALUE
				, TRUNC(MIN(ESTI_VALUE),2) AS MIN_VALUE
				, TRUNC(MAX(ESTI_VALUE),2) AS MAX_VALUE
			 FROM 
			 E13 
			 GROUP BY ITEM_NM
		]]>
	</select>
	
</mapper>